export function generatePrompt(siteText: string, url: string, inn?: string): string {
  const basePrompt = `Инструкция по Форматированию Отчета (Обязательно к Выполнению):

Генерируй отчет строго в формате Markdown для максимальной читаемости. Используй:

КРИТИЧЕСКИ ВАЖНО - Используй стандартный Markdown синтаксис:
- ## для основных разделов (## Финансовый Анализ)
- ### для подразделов (### 1.1. **Финансовое Состояние**)
- **текст** для жирного шрифта
- *текст* для курсива
- - для маркированных списков
- | таблицы | в | markdown | формате
- НЕ добавляй лишних символов кроме стандартного Markdown

Обязательные правила форматирования:
- **Все заголовки подразделов ### ОБЯЗАТЕЛЬНО должны иметь жирное название после номера**
- Примеры: ### 1.1. **Финансовое Состояние**, ### 2.1. **Металлопрокат**, ### 4.1. **Лучшее Первое Касание**
- **Ключевые данные выделяй жирным:** **546 млн руб.**, **12Х18Н10Т**, **МНЖ5-1**
- **НЕ используй эмодзи в отчете - только чистый текст**
- Пустые строки между абзацами для читаемости

---

## ПРЕДВАРИТЕЛЬНАЯ КВАЛИФИКАЦИЯ (ОБЯЗАТЕЛЬНЫЙ ШАГ)

Используя Google Search, ИНН и данные сайта, **немедленно определи основной вид деятельности компании (ОКВЭД) и ее отраслевую принадлежность.**

- **Целевой клиент:** Компания, занимающаяся **производством**, **строительством**, **машиностроением**, **энергетикой**, **добычей полезных ископаемых** или любой другой деятельностью, требующей регулярных закупок металлопроката.

- **Нецелевой клиент:** Компании, оказывающие услуги (консалтинг, IT, юридические, финансовые, маркетинг), розничная торговля (не связанная с металлом), образовательные учреждения и т.п.

---

**КРИТИЧЕСКИ ВАЖНОЕ ПРАВИЛО ВЫПОЛНЕНИЯ:**

1. **ЕСЛИ КОМПАНИЯ НЕ ЯВЛЯЕТСЯ ЦЕЛЕВЫМ КЛИЕНТОМ:**
   - **НЕ ГЕНЕРИРУЙ** стандартный отчет (Разделы 1-5).
   - **НЕ ПЫТАЙСЯ** выдумать информацию о закупках металла.
   - Вместо этого, немедленно останови анализ и выведи **ТОЛЬКО** следующий текст:

## АНАЛИЗ НЕЦЕЛЕСООБРАЗЕН

**Компания:** [Полное юридическое название компании]  
**Юридический адрес:** [Полный юридический адрес (найди через Google Search)]  
**ИНН:** [ИНН компании (найди через Google Search)]  
**Дата анализа:** [текущая дата]

---

**Причина:** Компания является [указать отрасль/тип, например: **"консалтинговым агентством"** или **"IT-разработчиком"**] и не занимается производственной деятельностью. Закупки металлопроката не являются профильными.

**Рекомендация:** Квалифицировать как **нецелевого клиента**. Проведение дальнейшего анализа не требуется.

2. **ЕСЛИ КОМПАНИЯ ЯВЛЯЕТСЯ ЦЕЛЕВЫМ КЛИЕНТОМ:**
   - **ОБЯЗАТЕЛЬНО** начни отчет с раздела "## АНАЛИТИЧЕСКИЙ ОТЧЕТ" (как указано далее в инструкции).
   - Продолжай генерацию полного отчета, начиная с раздела "## Финансовый Анализ и Надежность Компании", строго следуя всем инструкциям ниже.

---

Начинай отчет в следующем формате:

## АНАЛИТИЧЕСКИЙ ОТЧЕТ

**Компания:** [Полное юридическое название компании]  
**Юридический адрес:** [Полный юридический адрес (найди через Google Search)]  
**ИНН:** [ИНН компании (найди через Google Search)]  
**Дата анализа:** [текущая дата]

---

ВАЖНО: 
- Используй Google Search чтобы найти ТОЧНЫЙ юридический адрес и ИНН компании
- Если ИНН предоставлен в запросе, используй его
- Если URL предоставлен, найди ИНН и адрес через поиск

Освещай все пункты последовательно, без пропусков. Делай текст кратким, но информативным — приятным для чтения менеджером (короткие предложения, bullet points).

Не используй сырой текст — весь отчет должен быть в Markdown, чтобы после API-обработки он отображался красиво в сервисе (жирное, списки, отступы).

ВАЖНО: Отвечай в свободной форме, НЕ используй JSON-формат! Только обычный текст с Markdown-разметкой.

---

Инструкция к Исполнению (ОБЯЗАТЕЛЬНОЕ использование инструмента Google Search):

Проанализируй компанию-потенциального клиента используя данные с указанного сайта и/или по ИНН/ОГРН, **ОБЯЗАТЕЛЬНО** выполнив поиск в Google для сбора финансовой, закупочной и отраслевой информации.

${inn ? `**ИНН компании:** ${inn}` : `**Сайт компании:** ${url}`}

${siteText ? `**Содержимое сайта:**\n${siteText.substring(0, 30000)}` : '**Информация с сайта недоступна.**'}

Цель — предоставить отчет для компании-посредника (металлоторговца-перекупщика).

---

**Главная Цель Отчета:** Подготовить менеджера по продажам к эффективному первому контакту и долгосрочному взаимодействию, максимизируя маржинальность сделок.

---

## ФИНАНСОВЫЙ АНАЛИЗ И НАДЕЖНОСТЬ КОМПАНИИ

Проведи анализ финансовой составляющей Компании за последние 2 полных года и текущий период (на основе общедоступных данных и поисковых запросов). ЗАПРЕЩЕНО включать в отчёт любые финансовые показатели (цифры, таблицы или упоминания) за периоды, более ранние, чем два полных года назад. Публикуй данные только при условии их актуальности.

### 1.1. **ФИНАНСОВОЕ СОСТОЯНИЕ**

Оцени динамику выручки, чистой прибыли, рентабельности и ликвидности. Определи общую финансовую устойчивость и платежеспособность. Выдели ключевые выводы в таблице или списке.

### 1.2. **РИСКИ**

Выяви потенциальные финансовые риски, долги, или значительные изменения в активах, которые могут повлиять на решения о закупках или сроки оплаты. Перечисли в маркированном списке с рекомендациями.

---

## АНАЛИЗ ЗАКУПОЧНОЙ ДЕЯТЕЛЬНОСТИ

Детально проанализируй, какие позиции Компания закупает для своей основной и вспомогательной деятельности (на основе парсинга сайта, отраслевой принадлежности и закупочных тендеров/новостей).

### 2.1. **МЕТАЛЛОПРОКАТ**

**Основные Закупаемые Позиции (Металл):**
Определи точные марки, сортаменты, типы и объемы металлопроката, которые Компания закупает регулярно (например: нержавеющая сталь 12Х18Н10Т, балка двутавровая 30К1). Используй вложенный список для позиций.

**Потребность/Цикличность:**
Выяви цикличность или сезонность закупок конкретных видов металла. Опиши в пунктах с примерами.

### 2.2. **ПРОЧЕЕ СНАБЖЕНИЕ**

**Общий Профиль Закупок:**
Что Компания закупает в принципе для своей деятельности (кроме металла)? Перечисли в списке.

**Польза для Отдела Снабжения:**
Определи, в снабжении каких именно непрофильных, но необходимых товаров (кроме металла) компания-посредник может быть полезна Отделу Снабжения Компании, используя модель перекупщика. Дай 3–5 идей в жирных пунктах.

---

## ВЫЯВЛЕНИЕ ВЫСОКОМАРЖИНАЛЬНЫХ И РЕДКИХ ПОЗИЦИЙ

На основе анализа деятельности, отрасли Компании и текущей геополитической/рыночной ситуации (используя Google Search), выяви позиции металлопроката или других товаров, которые могут быть редкими или высокомаржинальными для поставщика-перекупщика.

### 3.1. **ПРИЗНАКИ РЕДКОСТИ/МАРЖИНАЛЬНОСТИ**

Проанализируй, какие позиции являются редкими ввиду:

- **Специфических Требований** (уникальные сплавы, нестандартные размеры, специфические ГОСТ/ASTM).
- **Географии/Логистики** (сложность доставки, удаленность поставщиков).
- **Санкционных Ограничений** (товары, попавшие под санкции или требующие параллельного импорта).
- **Монополии/Дефицита** (позиции с ограниченным числом поставщиков на рынке).

Структурируй как вложенный маркированный список с примерами из поиска.

### 3.2. **РЕКОМЕНДАЦИЯ**

Укажи конкретные позиции, на которых компания-посредник сможет заложить максимальную маржу, используя свою гибкость перекупщика. **Не выдумывай позиции**, а аналитически выведи их из профиля деятельности Компании. Перечисли 4–6 позиций в жирном списке с обоснованием.

---

## ИНСАЙТЫ И СТРАТЕГИЯ ВЗАИМОДЕЙСТВИЯ

Предоставь менеджеру по продажам конкретные советы и инсайты по взаимодействию с этой Компанией.

### 4.1. **ЛУЧШЕЕ ПЕРВОЕ КАСАНИЕ**

Сформулируй идеальный подход для первого контакта (звонок/встреча). На чем должен быть сделан акцент? Опиши в 3–5 шагах списка.

### 4.2. **СТРАТЕГИЯ ДОЛГОСРОЧНОЙ РАБОТЫ**

Дай советы о том, как работать в долгую с Компанией. Используй нумерованный список для шагов.

### 4.3. **ОСОБЕННОСТИ ПЕРЕГОВОРНОГО ПРОЦЕССА**

Определи, на что Компания будет реагировать сильнее всего: цена, сроки, наличие редких позиций, или условия оплаты. Ранжируй в приоритетном списке с советами.

---

## КЛЮЧЕВЫЕ РЕКОМЕНДАЦИИ

Заверши отчет разделом **КЛЮЧЕВЫЕ РЕКОМЕНДАЦИИ** с 5–7 жирными пунктами для менеджера.`;

  return basePrompt;
}
